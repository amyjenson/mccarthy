\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.1in,9.0in},top=1.1in,left=1.3in]{geometry}

\usepackage{verbatim}
\usepackage{empheq}
\usepackage[dvipsnames]{xcolor}
\usepackage{animate}
\usepackage{graphicx}
\usepackage{fancyvrb}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % only if colorlinks=true
citecolor=Red,   % only if colorlinks=true
urlcolor=black     % only if colorlinks=true
]{hyperref}

\pdfinfo{
/Title (Numerical modelling of glaciers, ice sheets, and ice shelves)
/Author (Ed Bueler)
/Subject (numerical modelling of ice sheets)
/Keywords (numerical modelling, numerical analysis, glacier, ice sheet, ice shelf, shallow models)
}

\renewcommand{\baselinestretch}{1.05}

\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\pp}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\devstress}{\tau}

\newcommand{\minput}[1]{
\vspace{0.8cm}
\VerbatimInput[frame=single,framesep=3mm,label=\fbox{\normalsize \textsl{\,#1.m\,}},fontfamily=courier,fontsize=\footnotesize]{tmp/#1.slim.m}
\vspace{0.5cm}
}

% usage:  \onefigsize{name}{caption}{width}
\newcommand{\onefigsize}[3]{
\begin{figure}[ht]
\centering
\includegraphics[width=#3,keepaspectratio=true]{#1}
\caption{#2}
\label{fig:#1}
\end{figure}}

% usage:  \onefig{name}{caption}
\newcommand{\onefig}[2]{\onefigsize{#1}{#2}{3.0in}}

% usage:  \twofigsizes{left-name}{right-name}{caption}{left-width}{right-width}
\newcommand{\twofigsizes}[5]{
\begin{figure}[ht]
\centering
\includegraphics[width=#4,keepaspectratio=true]{#1} \quad
\includegraphics[width=#5,keepaspectratio=true]{#2}
\caption{#3}
\label{fig:#1}
\end{figure}}

% usage:  \twofig{left-name}{right-name}{caption}
\newcommand{\twofig}[3]{\twofigsizes{#1}{#2}{#3}{2.5in}{2.5in}}



\begin{document}
\graphicspath{{../figures/}}

\begin{titlepage}

  \begin{center}
  \phantom{foo}
    \vspace{1.0cm}

     {\Large \textsc{Numerical modelling}}
    \vspace{0.7cm}

     {\Large \textsc{of glaciers, ice sheets, and ice shelves}}

    \vspace{1.5cm}

    {\large Ed Bueler}
    \vspace{1cm}

    International Summer School in Glaciology

    McCarthy Alaska

    2010, 2012, 2014, 2016, 2018, 2022, 2024

    \vfill
    
    \includegraphics[width=6.0in]{flowline}
  
    \scriptsize \emph{Illustrates the notation used in these notes.  Figure modified from \cite{SchoofMarine1}.} \normalsize
    
    \vspace{1.5in}
  \end{center}
\end{titlepage}

\clearpage\newpage

\setcounter{page}{2}
%\setcounter{section}{1}
\section{Introduction}  \label{sec:intro}

The greatest importance of mathematical and numerical models to science, and to glaciology in particular, is in \emph{introspection}.  In building and using a model you are asking yourself: When I combine my imperfect and incomplete understanding of glacier processes into this model does it behave as I expect?  A person who does not actually understand your scientific explanation might nod and say ``yes, I understand.''  The dumb computer, however, can only tell you consequences of your model, inadequacies and all.  Numerical models can show how processes interact to give overall behavior, and they can demonstrate flaws in understanding of those processes.

But numerical models must be built with care.  An avoidable bad outcome is to spend time---or worse, reputation---interpreting, explaining, or justifying model behavior that is actually an artifact of buggy computer programming or flawed numerical analysis.

Continuum models, and not computer codes, will be the primary focus of these notes.  (This might be surprising!)  While all codes produce numbers, we want numbers that actually come from the intended continuum model.  Only careful analysis of a numerical implementation can confirm that it matches the model equations.

\subsection*{Scope}  These notes have a limited scope:
  \begin{quote}\emph{shallow approximations of ice flow.}\end{quote}
They adopt a constructive approach:
  \begin{quote}\emph{we provide understandable numerical codes that actually run.}\end{quote}

Our scope includes the shallow ice approximation (SIA) in two horizontal dimensions (2D), the shallow shelf approximation (SSA) in 1D, and the mass continuity and surface kinematical equations.  (These technical terms will be defined in due course.)  We also recall the Stokes model here, and a separate Appendix addresses its numerical solution.

Numerical concepts within our scope include finite difference schemes, solving algebraic systems from stress balances, and the verification of codes using exact solutions.

\subsection*{Notation}  Our notation, which generally follows \cite{GreveBlatter2009}, is covered by Table \ref{tab:notation}.  Cartesian coordinates are $x,y,z$ with $z$ positive-upward, plus time $t$.  These coordinates appear as subscripts to denote partial derivatives: $u_x = \partial u/\partial x$.  Tensor notation uses subscripts from the list $\{1,2,3,i,j\}$.  Thus $\tau_{ij}$, $\tau_{13}$ denote entries of the deviatoric stress tensor.

\begin{table}[ht]
\caption{Notation used in these notes.}
\begin{tabular}{clll}
variable  & description & SI units & value \\
\hline
$A$ & $A=A(T)=$ ice softness in Glen law & $\text{Pa}^{-n}\,\text{s}^{-1}$ \\
$B$ & ice hardness; $B=A^{-1/n}$ & $\text{Pa}\,\text{s}^{1/n}$ \\
$b$ & bedrock elevation & m \\
$c$ & specific heat & J kg$^{-1}$ K$^{-1}$ \\
$\nabla$ & (spatial) gradient & m$^{-1}$ \\
$\nabla\cdot$ & (spatial) divergence & m$^{-1}$ \\
$\mathbf{g}$ & gravity & m s$^{-2}$\phantom{foobar} & 9.81 \\
$H$ & ice thickness & m \\
$h$ & ice surface elevation & m \\
$\kappa$ & temperature conductivity & J s$^{-1}$ m$^{-1}$ K$^{-1}$ \\
$M$ & climatic mass balance & m s$^{-1}$ \\
$n$ & exponent in Glen flow law & & 3 \\
$\nu$ & viscosity & Pa s \\
$p$ & pressure & Pa \\
$\bq$ & map-plane ice flux: $\bq = \int_{b}^{h} \bU\,dx$ & $\text{m}^2\,\text{s}^{-1}$ \\
$\rho$ & density of ice & kg m$^{-3}$ & 910 \\
$\rho_w$ & density of sea water & kg m$^{-3}$ & 1028 \\
$\sigma_{ij}$ & Cauchy stress tensor: $\sigma_{ij} = \tau_{ij} - p\, \delta_{ij}$ & Pa \\
$T$ & temperature & K \\
$\tau_{ij}$ & deviatoric stress tensor & Pa \\
$Du_{ij}$ & strain rate tensor & s$^{-1}$ \\
$\mathbf{U}$ & $=(u,v)$ horizontal ice velocity & m s$^{-1}$ \\
$\mathbf{u}$ & $(u_1,u_2,u_3)=(u,v,w)$ 3D ice velocity & m s$^{-1}$ \\
$x_i$ & $x_1,x_2,x_3=x,y,z$ coordinates & m
\end{tabular}
\label{tab:notation}
\end{table}

\subsection*{Downloading codes}  These notes are based on nineteen Matlab codes, each about one-half page.  All have been tested in Matlab and Octave.  They are distributed by cloning the \texttt{git} repository at
\begin{quote}
\url{https://github.com/bueler/mccarthy}
\end{quote}
\noindent The codes are in the \texttt{mfiles/} subdirectory.  Five of them are printed below with their comments stripped for compactness and clarity.  The electronic versions have generous comments and help files.


\section{Ice flow equations}  \label{sec:continuum}

Our initial goal is an equation for which one might say:
\begin{center}
\emph{by numerically solving this equation one has a usable model for an ice sheet.}
\end{center}
A usable model must be \emph{understood} at least as much as it is \emph{correct} in a physical sense.  Our initial model will not be complete by any modern standard.

First we (briefly!) recall the continuum mechanical equations of ice flow.  Ice in glaciers is a moving fluid so we describe its motion by a velocity field $\mathbf{u}(t,x,y,z)$.  If the ice fluid were faster-moving than in reality, and if it were linearly-viscous like liquid water, then it would be a ``typical'' incompressible fluid and we would use the Navier-Stokes equations as the model:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressible} \\
\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) &= \nabla \cdot (\nu \nabla \mathbf{u}) - \nabla p + \rho \mathbf{g} &&\text{\emph{stress balance}} \label{navierstokes}
\end{align}

Equation \eqref{navierstokes} says ``$ma=F$''; it is Newton's second law.  The term $\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}$ is an acceleration while the right-hand side is net force per unit volume, from viscous, pressure, and gravity forces respectively.  If $\sigma$ is the Cauchy stress tensor, the right side can also be written $\nabla \cdot \sigma + \rho \mathbf{g}$.

The space of solutions to \eqref{incompressible} and \eqref{navierstokes} is rich.  It includes turbulent flows, which we will not need here.  Reading a book-length introduction to fluids such as \cite{Acheson} is overkill for glacier modeling, but it is recommended for broader education.

The numerical solution of the Navier-Stokes equations is \emph{computational fluid dynamics} (CFD).  One might ask: is ice flow modelling really a part of CFD?  Does a good general-purpose CFD text like \cite{Wesseling} help a glaciers student?  While glacier flow is a large-scale fluid problem, comparable to atmosphere and ocean circulation, from the point of view of general CFD it is strange.   Topics which might make ocean circulation exciting, for example turbulence, convection, coriolis force, and density stratification, are irelevant to ice flow.  What could be interesting about the flow of slow, thick ice?

\subsection*{The Glen-Stokes equations}  Glacier ice is a slow fluid.  In terms of equation \eqref{navierstokes}, ``slow'' is a reasonably-precise term which means that $\rho \left(\mathbf{u}_t + \mathbf{u}\cdot\nabla \mathbf{u}\right) \approx 0$, in other words that the forces (stresses) of inertia are negligible.  However, ice is also a shear-thinning fluid with a specific kind of nonlinearly-viscous (``non-Newtonian'') behavior in which larger strain rates imply smaller viscosity.  The viscosity $\nu$ in \eqref{navierstokes} is therefore not constant, and one must add an empirically-based flow law.  Combining these ideas gives the standard model for isothermal ice flow:
\begin{align}
\nabla \cdot \mathbf{u} &= 0 &&\text{\emph{incompressibility}} \label{incompressibleagain} \\
- \nabla \cdot \tau_{ij} + \nabla p &= \rho \mathbf{g} &&\text{\emph{stress balance}} \label{forcebalance} \\
Du_{ij} &= A \tau^2 \tau_{ij} &&\text{\emph{$n$=3 Glen flow law}} \label{flowlaw}
\end{align}

In \eqref{flowlaw} the deviatoric stress tensor $\tau_{ij}$ and the strain rate tensor $Du_{ij}$ now appear.  Other lectures cover these ideas, but recall that by definition
    $$Du_{ij} = \frac{1}{2} \left((u_i)_{x_j}+(u_j)_{x_i}\right).$$
Both tensors in \eqref{flowlaw} are symmetric and have trace zero.  Note that $\tau^2 = (1/2) \tau_{ij} \tau_{ij}$, using the summation convention, which defines the \emph{effective stress} $\tau$.

Because the Stokes equations do not contain a time derivative, the combined effect of boundary stresses, gravity $\rho \mathbf{g} = \left<0,0,-\rho g\right>$, and a value for ice softness $A>0$ will determine the velocity and stress fields ($\bu$, $p$, $\tau_{ij}$).  Equations \eqref{incompressibleagain}--\eqref{flowlaw} apply at each instant, even as the glacier geometry and the solution fields change.  Ice flow simulation codes need no memory of prior momentum or velocity.  Said another way, velocity is a ``diagnostic'' output of ice flow models.  Unlike in a Navier-Stokes-based simulation, velocity is not needed for (re)starting a simulation.

Consider now the $x,z$-plane case of equations \eqref{incompressibleagain}--\eqref{flowlaw}.  Such a planar flow has velocity component $v=0$.  All derivatives with respect to $y$ are also zero so the equations are:
\begin{align}
u_x + w_z &= 0 &&\text{\emph{incompressibility}} \label{incompressiblexz} \\
- \tau_{11,x} - \tau_{13,z} + p_x &= 0 &&\text{\emph{stress balance} ($x$)} \label{stokespx} \\
- \tau_{13,x} - \tau_{33,z} + p_z &= - \rho g &&\text{\emph{stress balance} ($z$)} \label{stokespz} \\
u_x &= A \tau^2 \tau_{11} &&\text{\emph{flow law (diagonal)}}  \label{forceflowx} \\
u_z + w _x &= 2 A \tau^2 \tau_{13} &&\text{\emph{flow law (off-diagonal)}} \label{forceflowz}
\end{align}
Note that $\tau_{13}$ is a shear stress while $\tau_{11}$ and $\tau_{33}=-\tau_{11}$ are deviatoric longitudinal stresses.  Also $\tau^2 = \tau_{11}^2+\tau_{13}^2$ in this case.  Equations \eqref{incompressiblexz}--\eqref{forceflowz} form a system of five nonlinear equations in five scalar unknowns ($u,w,p,\tau_{11},\tau_{13}$).

\subsection*{Slab-on-a-slope}  Equations \eqref{incompressiblexz}--\eqref{forceflowz} are complicated enough already!  They should make us pause before jumping into numerical solution methods.  For now we start with a simplified situation, namely a uniform slab of ice, in which we can both solve the Stokes equations exactly and motivate the shallow model in the next subsection.

\onefig{slab}{Rotated axes for a slab-on-a-slope flow calculation.}

We rotate our coordinates only for this example.  The two-dimensional axes ($x$,$z$) shown in Figure \ref{fig:slab} are rotated clockwise at angle $\alpha>0$ so that the gravity vector has components $\mathbf{g} = (g \sin\alpha,- g \cos \alpha)$ in the new axes.  Equations \eqref{stokespx} and \eqref{stokespz} are now
\begin{align}
- \tau_{11,x} - \tau_{13,z} + p_x &= \rho g \sin\alpha, \label{stokespxrot} \\
- \tau_{13,x} + \tau_{11,z} + p_z &= - \rho g \cos\alpha. \label{stokespzrot}
\end{align}

Assume further that there is no variation with $x$. Then the whole set of Stokes equations \eqref{incompressiblexz}, \eqref{forceflowx}--\eqref{stokespzrot} simplifies greatly:
\begin{align}
w_z &= 0 &   \tau_{11} &= 0 \label{stokesslab} \\
\tau_{13,z} &= - \rho g \sin\alpha &   u_z &= 2 A \tau^2 \tau_{13} \notag \\
p_z &= - \rho g \cos\alpha \notag
\end{align}
Each unknown is now a function of $z$ only.  Boundary conditions come from assuming that the ice is not crossing the bed, that the ice surface is moving parallel to the $x$-axis, and that the ice surface is stress free: $w(0)=0$, $p(H)=0$, $\tau_{13}(H)=0$.  Then, by integrating equations \eqref{stokesslab} with respect to $z$, we get $w=0$, $p = (\rho g \cos\alpha) (H-z)$, and $\tau_{13} = (\rho g \sin\alpha) (H-z)$.  Note that $H-z$ is the depth below the ice surface; both pressure and shear stress are proportional to depth.  Integrating the remaining equation in \eqref{stokesslab} yields horizontal velocity:
\begin{align}
u &= u_0 + \frac{1}{2} A (\rho g \sin\alpha)^3  \left(H^4 - (H-z)^4\right)  \label{uslab}
\end{align}
The basal velocity $u_0=u(0)$ remains undetermined for now.

Do we believe formula \eqref{uslab}, which makes a specific prediction about the profile of flow in a glacier?  Figure \ref{fig:slabvel} compares observations of a mountain glacier, showing that our model does a credible job of capturing deformation flow in this case.

\twofigsizes{slabvel}{athabasca-deform}{Left:  Velocity from formula \eqref{uslab}.  Right:  Measured velocity in a glacier (Athabasca Glacier \cite{SavagePaterson}).}{2.0in}{1.8in}

Until section \ref{sec:shelvesandstreams} we will not have a reasonable dynamical model for the sliding velocity $u_0$.  We assume until then that the ice is frozen to the bed and there is no sliding.


\subsection*{Viscosity form of the flow law}  Flow law \eqref{flowlaw} has another form.  Recall $\tau^2 = (1/2) \tau_{ij} \tau_{ij}$; also define $|Du|^2 = (1/2) Du_{ij} Du_{ij}$.  (The scalars $\tau$ and $|Du|$ are tensor \emph{norms}.)  From \eqref{flowlaw} we get $|Du| = A \tau^3$ so $\tau = A^{-1/3} |Du|^{1/3}$.  Thus \eqref{flowlaw} can be rewritten
\begin{equation}
\tau_{ij} = 2 \nu\, Du_{ij}  \qquad \text{\emph{flow law}} \label{viscosityflowlaw}
\end{equation}
where
    $$2\nu = A^{-1/3} |Du|^{-2/3}$$
defines the nonlinear \emph{viscosity} $\nu$.  Often $B = A^{-1/3}$ is called the \emph{ice hardness}.  Equation \eqref{viscosityflowlaw} allows us to eliminate stresses $\tau_{ij}$ from the Stokes equations, resulting in formulas depending only on the strain rates $Du_{ij}$.

\subsection*{The Blatter-Pattyn approximation}  One may approximate the plane-flow Stokes equations \eqref{incompressiblexz}--\eqref{forceflowz} by assuming that horizontal variation in the vertical shear stress is small compared to the other terms.  This removes the single term  $\tau_{13,x}$ from the $z$-component of the stress balance \eqref{stokespz}:
\begin{equation}
p_z = - \tau_{11,z} - \rho g. \label{hydrostaticpz}
\end{equation}
Because $\sigma_{ij} = \tau_{ij} - p \delta_{ij}$, thus $p + \tau_{11} = p - \tau_{33} = - \sigma_{33}$, equation \eqref{hydrostaticpz} says that the vertical normal stress $\sigma_{33}$ is linear in depth.  (A slightly-different model assumes that the pressure $p$ itself is hydrostatic.)  Taking $\sigma_{33}$ to have surface value zero we get
\begin{equation}
p + \tau_{11} = \rho g (h-z). \label{hydrostaticitself}
\end{equation}

Equation \eqref{hydrostaticitself} allows elimination of the pressure $p$ from the model equations.  Furthermore, taking the $x$-derivative of \eqref{hydrostaticitself}, then substituting into \eqref{stokespx} to eliminate $p_x$, and then using the viscosity form \eqref{viscosityflowlaw} leads to this equation \cite{GreveBlatter2009}:
\begin{equation}
\left(4 \nu u_x\right)_x + \left(\nu (u_z+w_x)\right)_z = \rho g h_x \qquad\text{\emph{hydrostatic stress balance}} \label{stresshydrostatic}
\end{equation}
Equations \eqref{incompressiblexz}, \eqref{viscosityflowlaw}, \eqref{stresshydrostatic}, plus appropriate boundary conditions, determine $u$ and $w$ and then all remaining unknowns.  However, although $p$ is gone, equation \eqref{stresshydrostatic} is nontrivially-coupled to incompressibility \eqref{incompressiblexz} because the vertical velocity $w$ appears in both places.

If we additionally drop $w_x$ from equation \eqref{stresshydrostatic} then we get the Blatter-Pattyn model:
\begin{equation}
\left(4 \nu u_x\right)_x + \left(\nu u_z\right)_z = \rho g h_x \qquad\text{\emph{Blatter-Pattyn stress balance}} \label{stressblatter}
\end{equation}
Solving \eqref{stressblatter} as a boundary value problem yields the horizontal velocity $u$.  Then one may recover $w$ from incompressibility \eqref{incompressiblexz}.  Because it is somewhat similar to the well-understood Poisson equation $u_{xx} + u_{zz} = f$, as described in \cite{LeVequeFD,MortonMayers} for example, the process of solving equation \eqref{stressblatter} is more familiar to many professionals than \eqref{stresshydrostatic}.

\subsection*{Plane-flow mass-continuity equation}  The equations so far do not address how a glacier or ice sheet changes shape.  For this we need to add a mass conservation equation.  We derive it here in an informal way, returning to the topic in section \ref{sec:masscont}.

Consider any $x,z$-plane flow with variable thickness and velocity, not just slab-on-a-slope.  Define the vertical average of the horizontal velocity:
	$$\bar U = \frac{1}{H}\int_0^{H} u\,dz.$$
The ice flux $q= \int_0^{H} u\,dz$ is the rate of flow input into the side of the area in Figure \ref{fig:slabmasscontfig}.  Ice can be added by climatic (surface) mass balance $M$ or by a difference in the flux $q=\bar U H$ between the left and right sides.

\onefigsize{slabmasscontfig}{Mass continuity equation \eqref{masscont1D} follows from considering this domain of ice, which has time-dependent area $A$.}{2.5in}

The area $A$ changes according to the sum of all the boundary contributions:
\begin{equation}
\frac{dA}{dt} = \int_{x_1}^{x_2} M(x,t)\,dx + \bar U_1 H_1 - \bar U_2 H_2. \label{masscontintegrated}
\end{equation}
In three-dimensions, \eqref{masscontintegrated} becomes an equation for $dV/dt$, the ice volume rate of change.

If the width $\Delta x=x_2-x_1$ is small then $A\approx \Delta x\, H$.  So we divide by $\Delta x$ and take $\Delta x \to 0$ in \eqref{masscontintegrated} to get
\begin{equation}
H_t = M - \left(\bar U H\right)_x \label{masscont1D}
\end{equation}
This \emph{mass continuity} differential equation describes change in the ice thickness in terms of surface mass balance and ice velocity.  Ice flow simulations can compute the velocity $u$ and then use this equation for the changing glacier geometry.


\section{Shallow ice sheets}   \label{sec:sia}

Ice sheet flow has four outstanding properties as a fluids problem.  Ice sheets are
\renewcommand{\labelenumi}{(\emph{\roman{enumi}})}
\begin{enumerate}
\item slow,
\item shallow,
\item non-Newtonian (shear-thinning), and
\item subject to widespread contact slip (basal sliding).
\end{enumerate}
The first numerical ice flow model in these notes accounts for the first three properties only.  It is the non-sliding, isothermal \emph{shallow ice approximation} (SIA).

Regarding shallowness (\emph{ii}), Figure \ref{fig:green-transect} shows both a no-vertical-exaggeration cross-section of Greenland at $71^\circ$ and the standard vertically-exaggerated version which is more familiar in the glaciological literature.  Without vertical exaggeration we see the ice sheet as a thin blanket, barely three-dimensional.  This illustrates that ice sheets are shallow.  Note, however, that the portion of an ice sheet which you seek to model may not be shallow.

\medskip

\onefigsize{green-transect}{A cross-section of the Greenland ice sheet ($71^\circ$ N), with width about 760 km and maximum thickness 3200 m, is shown by the upper two curves.  The thickened horizontal line (bottom) shows the same cross-section without vertical exaggeration.}{4.0in}

Our earlier slab-on-a-slope example can be converted into a rough derivation of the plane-flow SIA.  We vertically integrate velocity formula \eqref{uslab} in the $u_0=0$ case to get
\begin{equation}
\bar U H = \int_0^H \frac{1}{2} A (\rho g \sin\alpha)^3  \left(H^4 - (H-z)^4\right)\,dz = \frac{2}{5} A (\rho g \sin\alpha)^3 H^5. \label{siaubar}
\end{equation}
Regarding the surface slope, note $\sin \alpha \approx \tan\alpha = - h_x$ when $\alpha$ is a small angle.  Combining these statements with mass continuity \eqref{masscont1D} gives
\begin{equation}
  H_t = M + \left(\frac{2}{5} (\rho g)^3 A H^5 |h_x|^2 h_x\right)_x. \label{sia1D}
\end{equation}

Equation \eqref{sia1D} is the SIA equation for nonsliding plane flow.  Noting $h=H+b$, it models the evolution of an ice sheet's thickness $H$.  The model should, however, be solved subject to the constraint that the thickness is positive ($H\ge 0$) \cite{Bueler2016,JouvetBueler2012}.  For careful SIA derivations, which reduce the Stokes equations under a small depth-to-width ratio assumption, follow the Notes and References at the end.

We now state the complete SIA model in preparation for numerical solutions in section \ref{sec:numericalsia}.  Let $\mathbf{U} = (u,v)$ be the vector horizontal velocity; this is a 2D vector-valued function of 3D coordinates $(x,y,z)$.  The SIA shear stress approximation is $(\tau_{13},\tau_{23}) \approx - \rho g (h-z) \nabla h$, and equation \eqref{flowlaw} gives a formula for shear strain rates
\begin{equation*}
\mathbf{U}_z = 2 A |(\tau_{13},\tau_{23})|^{n-1} (\tau_{13},\tau_{23}) = - 2 A (\rho g)^n (h-z)^n |\nabla h|^{n-1} \nabla h.
\end{equation*}
By integrating vertically we get, in the non-sliding case,
\begin{equation}
\mathbf{U} = - \frac{2 A (\rho g)^n}{n+1} \left[H^{n+1} - (h-z)^{n+1}\right] |\nabla h|^{n-1} \nabla h.  \label{siavelocity}
\end{equation}
Mass continuity in 2D, which generalizes the 1D version \eqref{masscont1D}, says:
\begin{equation}
    H_t = M - \Div\left(\bar{\mathbf{U}} H\right)  \label{masscont}
\end{equation}
Equation \eqref{masscont} may be written $H_t = M - \Div \bq$ in terms of the map-plane flux $\bq = \int_{b}^{h} \mathbf{U}\,dz = \bar{\mathbf{U}}\,H$.  Note $\bar{\mathbf{U}}$ and $\bq$ are functions of 2D coordinates $(x,y)$ only.  Combining equations \eqref{siavelocity} and \eqref{masscont}, we get an equation for the rate of thickness change in terms of mass balance $M$, thickness $H$, and surface gradient $\grad h$:
\begin{equation}
H_t = M + \Div \left(\Gamma H^{n+2} |\grad h|^{n-1} \grad h \right). \label{sia}
\end{equation}
We have defined the positive constant $\Gamma = 2 A (\rho g)^n / (n+2)$ only to improve appearance.

Equation \eqref{sia} is the SIA in 2D.  Recalling our earlier promise, if we can solve \eqref{sia} numerically then we have a usable model for certain ice sheets.  Mary-Anne Mahaffy \cite{Mahaffy} used it in a 1976 numerical model of the Barnes ice cap in Canada, a particularly-simple ice sheet on a rather flat bed.  This was the start of numerical ice sheet modeling.

\subsection*{Analogy with diffusion equations}  Numerical methods for solving \eqref{sia} are modifications of methods for the better-known heat equation, e.g.~ $T_t = D T_{xx}$ for the temperature of a conducting rod, its simplest 1D form.  This model applies when material properties are constant and there are no heat sources.  The positive constant $D$ is the ``diffusivity,'' with SI units which can be read from comparing sides of the equation: $D\sim \text{m}^2 \text{s}^{-1}$.  This equation has a smoothing effect on the solution $T(t,x)$ as it evolves in time, because any local maximum or minimum in the temperature is flattened: $T_{xx}<0$ implies $T_t<0$, so $T$ decreases near a maximum, while $T_{xx}>0$ implies $T_t>0$, so $T$ increases near a minimum.  All extrema of the temperature diffuse away.

The 2D heat equation, which describes the temperature $T(t,x,y)$ of a planar object, is a closer analog of \eqref{sia}.  Recall that Fourier's law for conduction is the formula $\mathbf{Q} = - \kappa \grad T$ for heat flux $\mathbf{Q}$, where $\kappa$ is conductivity.  We will assume, so as to help the analogy to the SIA, that $\kappa(x,y)$ may vary in space, and we suppose the heat source $f(t,x,y)$ is variable.  Adding conservation of internal energy, we find the equation
\begin{equation}
\rho c T_t = f + \Div (\kappa \grad T). \label{heatearly}
\end{equation}
Here $\rho$ is density and $c$ is specific heat capacity.  Assuming $\rho c$ is constant, define the diffusivity $D=\kappa/(\rho c)$.  Defining $F = f/(\rho c)$, a rescaled source term, \eqref{heatearly} becomes
\begin{equation}
T_t = F + \Div (D\, \grad T). \label{heat}
\end{equation}
This 2D heat equation is similar to the above 1D equation $T_t = D T_{xx}$, but now with variable diffusivity and an additional heat source.

Figure \ref{fig:initialheat} shows a solution of \eqref{heat} in which the initial condition is a localized ``hot spot''.  Solutions of the heat equation always involve the spreading, in all directions, of any local concentration of heat; this is diffusion.

\twofigsizes{initialheat}{finalheat}{Left: Initial condition $T(0,x,y)$.   Right: A solution $T(t,x,y)$ of  \eqref{heat}, with $D=1$ and $F=0$, at $t=0.02$.}{2.8in}{2.8in}

The SIA equation \eqref{sia} and the heat equation \eqref{heat} are each diffusive, time-evolving partial differential equations (PDEs).  A side-by-side comparison is appropriate:
\begin{center}
\begin{tabular}{cc}
\vspace{1mm}
SIA:\, $H$ is ice thickness & \phantom{foo bar} heat: $T$ is temperature\phantom{foo bar}  \\
\vspace{1mm}
	$H_t = M + \Div \left({\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}\, \grad h \right)$  &  $T_t = F + \Div (D\, \grad T)$
\end{tabular}
\end{center}
\vspace{1mm}
Notice that the number of derivatives (one time and two space) and the signs of the various terms are the same.  Surface mass balance $M$ is analogous to heat source $F$.  The analogy suggests that we identify the \emph{SIA diffusivity} as:
\begin{equation}
	D = {\color{red}\Gamma H^{n+2} |\grad h|^{n-1}}.  \label{siadiffusivity}
\end{equation}

Diffusion acts quickly where $D$ is large.  SIA diffusivity formula \eqref{siadiffusivity} gives a large value when the ice is thick and steep, because ice flows downhill most-strongly in that case.  Our analogy also explains why the surfaces of ice sheets are smooth, at least once we overlook non-fluid processes like crevassing.

There are, however, conceptual and practical concerns about the \eqref{sia}$\leftrightarrow$\eqref{heat} analogy:
\begin{itemize}
\item The letters ``$H$'' and ``$h$'' generally denote different quantities in \eqref{sia}.  Are we allowed to regard \eqref{sia} as a diffusion anyway, even when the bed is not flat?
\item The diffusivity $D$ in \eqref{siadiffusivity} depends on the solution---both on thickness $H$ and surface slope $|\grad h|$---so equation \eqref{sia} is a nonlinear PDE.  Numerical solutions for nonlinear equations are, at least, more difficult to implement and analyze.
\item The diffusivity $D$ in \eqref{siadiffusivity} goes to zero at margins, where $H\to 0$, and at divides and domes, where $|\grad h|\to 0$.  Thus the solution ($h$ or $H$) is not smooth at these locations, though it is continuous everywhere.  The solution is not smooth even if the bed $b$ and surface mass balance $M$ \emph{are} smooth.  Large numerical errors will arise where the solution is not smooth.
\end{itemize}

Just as important is a physical deficiency of the SIA model, namely
\begin{itemize}
\item Ice flow is not very diffusive when significant longitudinal (membrane) stresses are present, as when ice is floating or sliding, or when the flow is significantly confined by terrain.
\end{itemize}
This concerns a deficiency of the SIA model, not just our analogy to explain it.

All four concerns are areas of active research in mathematical glaciology; see the Notes and References.


\section{Finite difference numerics}  \label{sec:fd}

Now we introduce numerical methods.  The above diffusion analogy suggests that numerical schemes for the heat equation are a good starting point for solving the SIA.  The analogy will lead us to a verified numerical scheme for \eqref{sia}.  We demonstrate only finite difference (FD) schemes, which replace derivatives by difference quotients.

Taylor's theorem says that for a smooth function $f(x)$,
	$$f(x+\Delta) = f(x) + f'(x) \Delta + \frac{1}{2} f''(x) \Delta^2 + \frac{1}{3!} f'''(x) \Delta^3 + \dots$$
One may also replace ``$\Delta$'' by its multiples, for example:
\begin{align*}
f(x+2\Delta) &= f(x) + 2 f'(x) \Delta + 2 f''(x) \Delta^2 + \frac{4}{3} f'''(x) \Delta^3 + \dots \\
f(x-\Delta) &= f(x) - f'(x) \Delta + \frac{1}{2} f''(x) \Delta^2 - \frac{1}{3!} f'''(x) \Delta^3 + \dots
\end{align*}
When constructing FD methods for differential equations the idea is to combine expressions like these to give approximations of the derivatives in the equation.  The resulting algebraic equations, relating unknown gridded solution values via mere arithmetic, will approximate the differential equation.

We must apply Taylor expansions for each variable to approximate the partial derivatives appearing in the heat and SIA equations.  For example, for $u=u(t,x)$ we have
\begin{align*}
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t,x)}{\Delta t} + O(\Delta t), \\
u_t(t,x) &= \frac{u(t+\Delta t,x) - u(t-\Delta t,x)}{2\Delta t} + O((\Delta t)^2), \\
u_x(t,x) &= \frac{u(t,x+\Delta x) - u(t,x-\Delta x)}{2\Delta x} + O((\Delta x)^2), \\
u_{xx}(t,x) &= \frac{u(t,x+\Delta x) - 2\, u(t,x) + u(t,x-\Delta x)}{\Delta x^2} + O((\Delta x)^2)
\end{align*}
Note that if $\Delta$ is a small number then $O(\Delta^2)$ is smaller than $O(\Delta)$; the first approximation is inferior to the latter three in this sense.

\subsection*{Explicit scheme for the heat equation}  Our simplest scheme approximates the 1D heat equation $T_t=D T_{xx}$ \emph{explicitly}.  It is based on the fact that because $T_t$ and $D T_{xx}$ are equal, these two FD expressions are nearly equal:
\begin{equation}
\frac{T(t+\Delta t,x) - T(t,x)}{\Delta t} \approx D\,\frac{T(t,x+\Delta x) - 2\, T(t,x) + T(t,x-\Delta x)}{\Delta x^2}.  \label{heat1Dapproximated}
\end{equation}
While \eqref{heat1Dapproximated} only approximates the PDE, forcing it to be an equality allows us to determine grid values.  Let $(t_n,x_j)$ denote the points of the time-space grid shown in Figure \ref{fig:timespacegrid}.  It has spacing $\Delta x>0$ and $\Delta t>0$ in the two dimensions.  Denote our approximation of the solution value $T(t_n,x_j)$ by $T_j^n$.  The finite difference scheme is
	$$\frac{T_j^{n+1} - T_j^n}{\Delta t} = D\,\frac{T_{j+1}^n - 2\, T_j^n + T_{j-1}^n}{\Delta x^2}.$$
To get a simplified formula, let $\mu = D \Delta t / (\Delta x)^2$ and solve for $T_j^{n+1}$:
\begin{equation}
  T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n \label{heat1Dfd}
\end{equation}

\onefigsize{timespacegrid}{A grid for a finite difference solution to the 1D heat equation.}{2.0in}

FD scheme \eqref{heat1Dfd} is \emph{explicit} because it directly (explicitly) computes $T_j^{n+1}$ in terms of values at time $t_n$.  Figure \ref{fig:expstencil} (left) shows the ``stencil'' for scheme \eqref{heat1Dfd}: three values at the current time $t_n$ are combined to update one value at the next time $t_{n+1}$.

\twofigsizes{expstencil}{exp2dstencil}{Left: Space-time stencil for the explicit scheme \eqref{heat1Dfd} for the 1D heat equation.  Right: Spatial-only stencil for scheme \eqref{heat2dexplicit}.}{2.0in}{2.1in}

The expression $T(t_n,x_j)$ is the value of a heat equation solution at a grid point.  This is generally a different number from $T_j^n$, the value actually computed by a scheme like \eqref{heat1Dfd}.  Because the FD expressions become closer to the derivatives they approximate, we intend that the numbers $T(t_n,x_j)$ and $T_j^n$ become closer together as the grid is made finer ($\Delta t \to 0$ and $\Delta x \to 0$).  That is, we intend our FD scheme to \emph{converge} under \emph{grid refinement}.  Proving that such convergence happens is a main topic in numerical textbooks \cite{LeVequeFD,MortonMayers}.  Even if we expect convergence to happen, this needs checking for the actual computer program which is our implementation (\emph{verification}; Section \ref{sec:exactsolutions}).

How accurate is scheme \eqref{heat1Dfd}?  Our construction tells us that the difference between the scheme \eqref{heat1Dfd} and the PDE it solves is $O(\Delta t + (\Delta x)^2)$.  This difference goes to zero as we refine the grid in space and time, a scheme property called \emph{consistency}.  With care about the smoothness of boundary conditions, and using mathematical facts about the heat equation itself, one can also show that the difference between $T_j^n$ and $T(t_n,x_j)$ is $O(\Delta t + (\Delta x)^2)$, the \emph{convergence rate}.  However, to get convergence the scheme must be \emph{stable}, which we address below.  The main theorem for numerical PDE schemes asserts that ``consistency plus stability implies convergence''.  See the Notes and References.

Instead of pursuing theory, in these notes we emphasize something practical, namely verification using exact solutions.  We will find PDE problems for which we already know an exact solution $T(t,x)$, and then compute differences like $|T_j^n - T(t_n,x_j)|$ and confirm that they go to zero under grid refinement.  This demonstrates directly that our actual implementation converges, not just that it should do so in theory.  A verified code can be confidently applied to real situations.

\subsection*{A first implemented scheme}  Our first Matlab implementation is for the 2D heat equation \eqref{heat} with $D$ constant and $F=0$:
\begin{equation}
T_t = D (T_{xx}+T_{yy}).\label{heat2D}
\end{equation}
We solve this equation on the square $-1 < x < 1$, $-1 < y < 1$.  For a simple example problem we set $T=0$ on the boundary of the square and choose a gaussian initial condition: $T(0,x,y) = \exp(-30 (x^2+y^2))$.

Writing $T_{jk}^n \approx T(t_n,x_j,y_k)$, the 2D explicit scheme is
\begin{equation}
	\frac{T_{jk}^{n+1} - T_{jk}^n}{\Delta t} = D\,\left(\frac{T_{j+1,k}^n - 2\, T_{jk}^n + T_{j-1,k}^n}{\Delta x^2} + \frac{T_{j,k+1}^n - 2\, T_{jk}^n + T_{j,k-1}^n}{\Delta y^2}\right). \label{heat2dexplicit}
\end{equation}
The stencil for the right side of \eqref{heat2dexplicit} is in Figure \ref{fig:expstencil}.  Using Matlab colon notation to implement loops over the spatial variables, our scheme becomes \texttt{heat.m} below.  

Consider the example run:
\begin{Verbatim}
>>  heat(1.0,30,30,0.001,20);
\end{Verbatim}
This sets $D=1.0$, uses a $30\times 30$ spatial grid, sets $\Delta t = 0.001$, and takes $N=20$ time steps.  The result was already shown in Figure \ref{fig:initialheat} (right); this is the look of success.

\minput{heat}

However, very similar runs seem to succeed or fail according to some as-yet unclear circumstances.  For example, results from these calls are shown in Figure \ref{fig:stability}:
\begin{Verbatim}
>> heat(1.0,40,40,0.0005,100);    % Figure 8, left
>> heat(1.0,40,40,0.001,50);      % Figure 8, right
\end{Verbatim}
Both runs compute temperature $T$ on the same spatial grid, for the same final time $t_f = N \Delta t = 0.05$, but with different time steps.  Noting the vertical axes, the second run clearly shows ``instability,'' an extreme form of inaccuracy characterized in practice by exponentially-growing solution magnitude.  (In fact the exact solution is bounded.)

\twofig{stability}{instability}{Numerically-computed temperature on $40\times 40$ grids.  The two runs are the same except that the left has $\Delta t=0.0005$ and $D\Delta t/(\Delta x)^2= 0.2$, while the right has $\Delta t=0.001$ and $D\Delta t/(\Delta x)^2= 0.4$.  Compare \eqref{stabcrit}.}

\subsection*{Stability criteria and adaptive time stepping}  To avoid such instabilities we need to understand the scheme better.  While we have not made an implementation error, we must learn how to choose compatible space and time steps.

Recall the 1D explicit scheme in form \eqref{heat1Dfd}: $T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n$.  The new value $T_j^{n+1}$ is an average of the old values, in the sense that the coefficients sum to one.  Averaging is stable because averaged wiggles are smaller than the wiggles themselves.

However, the scheme is only an average \emph{if} the coefficients, specifically the middle coefficient $1-2\mu$, are positive.  A linear combination with coefficients which add to one is not an average if some coefficients are negative.  For example, one would not accept 15 as an ``average'' of 5 and 7, but: $15 = -4 \times 5 + 5 \times 7$, and $-4+5=1$.

What consequences follow from requiring the middle coefficient in \eqref{heat1Dfd} to be positive?  We find a \emph{stability criterion}, with these equivalent forms:
\begin{equation}
   1 - 2 \mu \ge 0 \quad \iff \quad \frac{D\Delta t}{\Delta x^2} \le \frac{1}{2} \quad \iff \quad \Delta t \le \frac{\Delta x^2}{2 D}.  \label{stabcrit}
\end{equation}
The third form states the criterion as a limitation on the size of $\Delta t$.  It is a \emph{sufficient} stability condition; it guarantees stability though something weaker might do.

In summary, for a given value of $\Delta x$, shortening the time steps $\Delta t$ until \eqref{stabcrit} holds will make FD scheme \eqref{heat1Dfd} for the 1D heat equation into a stable averaging process.  Applying this same idea to the 2D heat equation \eqref{heat2D} leads to the stability condition $1-2\mu^x-2\mu^y \ge 0$, where $\mu^x = D \Delta t / (\Delta x^2)$ and $\mu^y = D \Delta t / (\Delta y^2)$.  In the cases shown in Figure \ref{fig:stability}, wherein $\Delta x=\Delta y$, this condition requires $D \Delta t /(\Delta x^2) \le 0.25$.  This inequality precisely distinguishes between these stable and unstable results, respectively.

Runs of \texttt{heat.m} are unstable if the time step $\Delta t$ is too large relative to the spacing $\Delta x$.  However, the stability criterion \eqref{stabcrit} can be enforced inside the code, and this is called an \emph{adaptive} implementation.  Changing \texttt{heat.m} in this way yields \texttt{heatadapt.m} (not shown).  Furthermore, such adaptive codes can be stable even if the diffusivity $D$ varies in space or time.  On the other hand, if the diffusivity $D$ is large, or if grid spacings $\Delta x$, $\Delta y$ are small, then adaptive explicit implementations must take many short time steps to assure stability.  Adaptive explicit schemes become inefficient on spatially-refined grids.

\subsection*{Implicit schemes}  \emph{Implicitness} is an alternative stability fix to adaptivity.  For example, the finite difference scheme
\begin{equation}
  \frac{T_j^{n+1} - T_j^n}{\Delta t} = D\,\frac{T_{j+1}^{n+1} - 2\, T_j^{n+1} + T_{j-1}^{n+1}}{\Delta x^2} \label{implicit1D}
\end{equation}
is an $O(\Delta t + (\Delta x)^2)$ implicit scheme for the 1D heat equation $T_t = D T_{xx}$.  This implicit \emph{backward Euler} scheme is stable for any positive time step $\Delta t>0$; it is \emph{unconditionally stable} \cite{LeVequeFD,MortonMayers}.  Another well-known implicit scheme for the heat equation is \emph{Crank-Nicolson}, an unconditionally-stable scheme with smaller error $O((\Delta t)^2 +(\Delta x)^2)$.

Implicit schemes are more difficult to implement because the unknown solution at time step $t_{n+1}$ must be treated as a vector, and a (large) linear or nonlinear system of equations must be formed and solved at each time step.  Though the SIA is a highly-nonlinear diffusion equation, implicit schemes are indeed implementable when appropriate solver tools are used \cite{Bueler2016}.  However, for these notes, in the tradeoff between the easy implementability of adaptive explicit schemes and the improved stability of implicit schemes, we choose the former. 

\subsection*{Numerical solution of generalized diffusion equations}  We are trying to numerically model flowing ice, not temperature as seen so far.  In this section, as a step toward an explicit and adaptive SIA code which works on nonflat beds, \texttt{diffstag.m} below is an implemented numerical scheme for a generalized diffusion equation:
\begin{equation}
  T_t = F + \Div \left(D \grad (T + b)\right). \label{gendiffusion}
\end{equation}
Equation \eqref{gendiffusion} has an extra ``tilt'' $b$ inside the gradient.  The source term $F(x,y)$, diffusivity $D(x,y)$, and tilt $b(x,y)$ may all vary in space.

\minput{diffstag}

This function is called for SIA-specific solution schemes, which we build next, using $b(x,y)$ equal to the bedrock elevation.  Its explicit time-stepping method is conditionally-stable, with the same time step restriction as for the constant diffusivity case.  For stability to apply under the same criterion it is important that we evaluate $D(x,y)$ at \emph{staggered} grid points.  That is, where $X=T+b$, we will be using the approximation
\begin{align*}
\Div \left(D \grad X\right) &\approx \frac{D_{j+1/2,k}(X_{j+1,k} - X_{j,k}) - D_{j-1/2,k}(X_{j,k} - X_{j-1,k})}{\Delta x^2} \\
	&\qquad + \frac{D_{j,k+1/2}(X_{j,k+1} - X_{j,k}) - D_{j,k-1/2}(X_{j,k} - X_{j,k-1})}{\Delta y^2}.
\end{align*}
Figure \ref{fig:diffstencil} (left) shows the stencil.  The user supplies the diffusivity $D(x,y)$ on the staggered grid (triangles).  The initial values $T(0,x,y)$, source term $F(x,y)$, and tilt $b(x,y)$ are supplied on the regular grid (diamonds).  When using this code for the flat-bed case of the SIA we will take $b=0$.

\twofigsizes{diffstencil}{mahaffystencil}{Left:  Spatial stencil for staggered-grid (triangles) evaluation of diffusivity $D$ in \eqref{gendiffusion}.  Right: Stencil showing how $D$ is evaluated in the SIA, from surface elevation (diamonds) and thicknesses (squares).}{2.2in}{2.2in}


\section{Numerically solving the SIA} \label{sec:numericalsia}

As already noted, we compute the SIA diffusivity $D$ on a staggered grid.  Various schemes for staggered-grid diffusivity have been proposed, but all involve averaging $H$ and differencing $h$ in a ``balanced'' way onto the staggered grid.  In the code \texttt{siaflat.m} below, which only works for a flat bed and zero surface mass balance, we use the Mahaffy \cite{Mahaffy} method.  The Mahaffy stencil for computing $D$ is shown in Figure \ref{fig:diffstencil} (right).  Note that this SIA solver calls \texttt{diffstag.m} (above).

For non-flat beds and actual climates, namely when the surface mass balance term $M$ can take either sign, \texttt{siaflat.m} does not suffice.  Its deficiences are corrected in an extended code \texttt{siageneral.m} (not shown), which in fact only alters a few lines.

\minput{siaflat}

Addressing ablation ($M<0$) requires a small modification which deserves exposure.  Note that the grounded ice margin occurs in areas of ablation where the SIA thickness solution $H$ goes to zero.  However, the thickness of ice must obviously be greater than or equal to zero everywhere: $H(t,x)\ge 0$.  It follows that geometry-evolving numerical glacier and ice sheet models are solving a \emph{free-boundary problem}.  For an explicit time-stepping scheme it suffices to make the following rule:
\begin{quote}
\emph{If the numerical computation generates an updated thickness which is negative then it is reset to zero:} \, $H_{j,k}^{n+1} \gets \max\{0,H_{j,k}^{n+1}\}$.
\end{quote}
Determining glacier-covered area is a major glaciological purpose for modeling, thus this seemingly-small complication is ubiquitous and unavoidable in explicit time-stepping glacier models if the margin is allowed to move.  Modelers often implement and then overlook the above rule; it violates conservation of mass \cite{Bueler2021conservation}.


\section{Exact solutions and verification} \label{sec:exactsolutions}

Program \texttt{siaflat.m} calls \texttt{diffstag.m}, so we already have a complicated code.  How can we make sure that such an implemented numerical scheme is correct?  Here are three proposed techniques in the modeling community:
\begin{enumerate}
  \item don't make any mistakes, or
  \item compare your numerical results with results from other researchers, and hope the outliers are in error, or
  \item compare your numerical results to an exact solution.   \end{enumerate}
The first two approaches, \emph{infallibility} and \emph{intercomparison} respectively, should be less common than they are.  The last one, preferred by the CFD community generally \cite{Roache,Wesseling}, is \emph{verification}.  It is a simple idea:  A computer code should be tested in cases where we know the right answer.  To do this we must return to the PDE itself.  We must seek-out useful exact solutions.

\subsection*{Exact solutions of heat equation}  Again consider the 1D heat equation $T_t = D T_{xx}$ with constant $D$.  Many exact solutions are known, but we will use the time-dependent \emph{Green's function}, circa 1830, also known as the \emph{heat kernel}.  It starts at time $t=0$ with a delta function $T(0,x)=\delta(x)$ of heat at the origin.  Then it spreads out over time, solving the equation on $-\infty<x<\infty$ and for $t>0$.  We calculate it by a method which generalizes to the SIA.

This Green's function is self-similar over time, in the sense that it changes shape \emph{only} by shrinking the output (vertical) axis and lengthening the input (horizontal) axis (Figure \ref{fig:heatscaling}).  These scalings are related to each other by conservation of energy.  Similarity variables for this solution involve multiplying the input and output of an invariant shape $\phi(s)$ by the same power of $t$:
\begin{equation}
s \stackrel{\text{\emph{input scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} x, \qquad\qquad T(t,x) \stackrel{\text{\emph{output scaling}}}{\phantom{\Big|}=\phantom{\Big|}} t^{-1/2} \phi(s).  \label{heatscalings}
\end{equation}
One may use $T_t = D T_{xx}$ to show that $\phi(s) = (4 \pi D)^{-1/2}\, e^{-s^2/(4D)}$, and thus
    $$T(t,x) = (4 \pi D t)^{-1/2}\, e^{-x^2/(4Dt)}.$$

To verify a numerical solver for the 1D heat equation using this exact solution we may evaluate this exact solution at $t_0>0$ to provide initial values.  At a later time $t_1>t_0$ the numerical solution should be close to the exact solution $T(t_1,x)$ (see the Exercises).

\onefigsize{heatscaling}{The Green's function of the heat equation has the same shape at each time, but with time-dependent input- and output-scalings.}{2.4in}

\subsection*{Halfar's similarity solution to the SIA}  Now we jump to the year 1981 in which Peter Halfar \cite{Halfar81} published the corresponding similarity solution of the SIA, at least for flat bed and zero surface mass balance.  For the 2D SIA model \eqref{sia} using a Glen exponent $n=3$ this solution \cite{Halfar83} has scalings similar to \eqref{heatscalings} above:
\begin{equation}
s = t^{-1/18} r, \qquad \qquad H(t,r)=t^{-1/9} \phi(s), \label{halfarscalings}
\end{equation}
where $r=(x^2+y^2)^{1/2}$ is the distance from the origin.  These scalings are related to each other by the constancy of total mass/volume, because no mass is gained or lost through the surface (see the Exercises). Scalings \eqref{halfarscalings} imply that, differently from heat, the diffusion of ice slows down dramatically as the shape flattens out.  That is, the powers $t^{-1/9}$ and $t^{-1/18}$ change very slowly for large times $t$.

\onefigsize{siascaling}{Radial sections of Halfar's solution \eqref{halfar} of \eqref{sia}, shown on $H$ (m) versus $r$ (km) axes at $t=1,10,100,1000,10000$ years.}{5.5in}

The Halfar solution formula is remarkably simple given all that it accomplishes:
\begin{equation}
H(t,r) = H_0 \left(\frac{t_0}{t}\right)^{1/9} \left[1 - \left(\left(\frac{t_0}{t}\right)^{1/18} \frac{r}{R_0}\right)^{4/3}\right]^{3/7}. \label{halfar}
\end{equation}
Here the characteristic time $t_0 = (18 \Gamma)^{-1} (7/4)^3 R_0^4 H_0^{-7}$ depends on the radius $R_0$ and the center height $H_0$.  In Figure \ref{fig:siascaling} we see that for times significantly greater than $t_0$ ($t/t_0 \gg 1$) the solution changes very slowly.  For example, the change between years $1$ and $100$ is larger than that between years $1000$ and $10000$.

\subsection*{Using Halfar's solution}  Formula \eqref{halfar} is simple to use for verifying time-dependent SIA models.  The code \texttt{verifysia.m} (not shown) takes as input the number of grid points in each ($x,y$) direction.  It uses the Halfar solution at 200 a as the initial condition, does a numerical run of \texttt{siaflat.m} to a final time 20000 a, and then compares to the Halfar formula at that time.  It computes the thickness \emph{numerical error}, the absolute difference between the numerical and exact thicknesses at the final time:
\small
\begin{verbatim}
>> verifysia(20)
average thickness error  = 22.310
>> verifysia(40)
average thickness error  = 9.459
>> verifysia(80)
average thickness error  = 2.771
>> verifysia(160)
average thickness error  = 1.085
\end{verbatim}
\normalsize

The average numerical thickness error decreases with increasing grid resolution, as expected for a correctly-implemented code.  What is less obvious is that almost any numerical implementation mistake will break such convergence.  That is, the reported errors will not shrink if there is any meaningful bug (see the Exercises).  The fragility of verification is its essential benefit!  One must implement the model correctly, not just generate good-looking results, to get convergence as above.

The Halfar solution has also been used for modelling real ice masses.  Nye and others \cite{NyeIcarus2000} used it to compare the long-time consequences of different flow laws for the south polar cap on Mars.  In particular, they evaluated $\text{CO}_2$ and $\text{H}_2\text{O}$ ice softness parameters by comparing the long-time behavior of the corresponding Halfar solutions to the observed polar cap properties.  Their conclusions:
  \begin{quote}
  \dots none of the three possible [$\text{CO}_2$] flow laws will allow a 3000-m cap, the thickness suggested by stereogrammetry, to survive for $10^7$ years, indicating that the south polar ice cap is probably not composed of pure $\text{CO}_2$ ice [but rather] water ice, \dots
  \end{quote}
This theoretical result has since been confirmed by sampling the surface of Mars.

Are exact solutions like Halfar's always available when needed?  No, of course not.  However, many ice flow models have exact solutions which are relevant to verification; see the Notes and References.  For example, we will use an exact solution for ice shelves in a later section.  An apparent absence of exact solutions to a given model may actually show that not enough thought has gone into the continuum model itself.

\subsection*{A test of robustness}  Verification is an ideal way to test a code, but another worthwhile test is for ``robustness'' in unusual or difficult input cases.  One asks: Does the model break?  Here one may not have a precise expectation of what the code \emph{should} do, but it should not produce obviously-unreasonable outputs.

The robustness test run by \texttt{roughice.m} (not shown) demonstrates that \texttt{siaflat.m} can handle an ice sheet with extraordinarily-large driving stresses.  Recall that the glaciological driving stress $\tau_d = - \rho g H \grad h$ appears in the SIA model as the shear stress $(\tau_{13},\tau_{23})$ at the base of the ice.  The driving stress is largest where the ice is thick and the surface slope $|\nabla h|$ is steep.  In our test we give \texttt{siaflat.m} a randomly-generated initial ice sheet which has huge driving stresses.  It is thick---average of 3000 m---with huge surface slopes because of random surface elevation values.  An initial shape is shown in Figure \ref{fig:roughinitial} (left).  During a run of just 50 model years on a 17 km grid, with time step determined adaptively from \eqref{stabcrit}, the maximum diffusivity $D$ decreases as the surface both lowers and becomes smooth through flow.  The time-step consequently increases, in this case by three orders of magnitude from about 0.0002 years to 0.2 years.  The maximum value of the driving stress decreases from $57$ bar ($= 5.7\times 10^6$ Pa) to $3.6$ bar.  At the end of the run the ice cap has the shape shown in Figure \ref{fig:roughinitial} (right).

\twofigsizes{roughinitial}{roughfinal}{The initial ice sheet at left, with huge driving stresses, evolves to the ice cap at right in only 50 model years.}{2.9in}{2.9in}

The final shape in Figure 12 is close to a Halfar solution, illustrating what he proved \cite{Halfar81,Halfar83}, namely that \emph{all} solutions of the zero-mass-balance SIA on a flat bed asymptotically approach his solution.  The Halfar solution is attracting and thus worth knowing.

\section{Application to the Antarctic ice sheet}   \label{sec:antapp}

Let us apply the SIA model to the Antarctic ice sheet.  To do this we must first modify \texttt{siaflat.m} to allow non-flat bedrock elevation $b(x,y)$ and arbitrary, though here time-independent, climatic mass balance $M(x,y)$.  Also we enforce non-negative thickness at each timestep, and add a minimal model of interaction with the ocean.  Specifically, we calve-off any ice that satisfies the flotation criterion (see Section \ref{sec:shelvesandstreams}).  The result is \texttt{siageneral.m} (not shown), a code only ten lines longer than \texttt{siaflat.m}.

\twofigsizes{antinitial}{antfinal}{Left: Initial surface elevation (m) of Antarctic ice sheet.  Right: Final surface elevation at end of 40 ka model run on 50 km grid.}{2.55in}{3.2in}

We use measured accumulation, bedrock elevation, and surface elevation from the ALBMAPv1 data set \cite{LeBrocqetal2010}.  Melt is not modelled so the climatic mass balance is equal to the precipitation rate.  (This is a reasonable approximation for Antarctica, but not for Greenland.)  These input data are read from a NetCDF file and preprocessed by an additional code \texttt{buildant.m} (not shown).

The code \texttt{ant.m} (not shown) calls \texttt{siageneral.m} to do the simulation in blocks of 500 model years.  The volume is computed at the end of each block.  Figure \ref{fig:antinitial} shows the initial and final surface elevations from a run of 40,000 model years on a $\Delta x = \Delta y = 50$ km grid.  (The runtime on a typical laptop is a few minutes.)  Areas of the actual Antarctic ice sheet with low-slope and fast-flowing ice experience thickening in the model, while near-divide ice in East Antarctica, in particular, thins.

Assuming the present-day Antarctic ice sheet is somewhere near steady state, these thickness differences reflect model inadequacies.  The lack of a sliding mechanism explains the thickening in low-slope areas.  The lack of thermomechanical coupling, or equivalently the constancy of ice softness in the model, and the fact that our isothermal $A$ value is quite ``soft'', explains the thinning near the divide.  We should be modelling floating ice too, but the SIA is completely inappropriate to that purpose; compare Section \ref{sec:shelvesandstreams}.  See the Notes and References for widely-used thermomechanical and membrane-stress modelling techniques which address these inadequacies.

Figure \ref{fig:antvolcompare} compares the ice volume time series for 50 km, 25 km, and 20 km grids.  This result, namely grid dependence of the ice volume, is typical.  One cause is that steep gradients near the ice margin are poorly resolved, but to differing degrees, at such coarse resolutions.  In any case, Figure \ref{fig:antvolcompare} is a warning about the interpretation of model runs.  Even if the data is available only on a fixed grid, the model should be run at different grid spacings to evaluate the dependence of model results on resolution.

\medskip
\onefig{antvolcompare}{Ice volume of the modeled Antarctic ice sheet, in units of $10^6 \, \text{km}^3$, from 50 km (top), 25 km (middle), and 20 km (bottom) grids.}


\section{Mass continuity and kinematical equations}   \label{sec:masscont}

In the SIA the stress balance becomes formula \eqref{siavelocity} for the velocity.  Combined with the mass continuity equation \eqref{masscont}, this gives model \eqref{sia} for evolution of the ice sheet thickness.  Equation \eqref{sia} therefore combines two concepts which we now want to think about separately, and in greater generality.

The most basic shallow assumption made by most ice flow models is that the surface and base of the ice are differentiable functions $z=h(t,x,y)$ and $z=b(t,x,y)$.  That is, though the Stokes theory allows the fluid boundary to be any closed surface in three-dimensional space, ice sheet and glacier models take a map-plane perspective and have a well-defined ice thickness: $H=h-b$.  For example, surface overhang is rarely allowed in models.

\emph{Kinematical} equations apply on the upper and lower surfaces of the ice sheet.  Let $a$ be the climatic mass balance function ($a>0$ is accumulation) and $s$ be the basal melt rate function ($s>0$ is basal melting).  We need these fields in thickness-per-time units; convert from mass flux units by assuming an ice density.  The net map-plane mass balance $M=a-s$, which appears in the mass continuity equation \eqref{masscont}, is the difference of these surface fluxes.  The \emph{(upper) surface kinematical equation} is
\begin{equation}
h_t = a - \mathbf{U}\big|_h \cdot \grad h + w\big|_h,  \label{surfkine}
\end{equation}
and the \emph{base kinematical equation} is
\begin{equation}
b_t = s - \mathbf{U}\big|_b \cdot \grad b + w\big|_b.  \label{basekine}
\end{equation}
In these equations $\mathbf{U}$ is the horizontal ice velocity and $w$ the vertical ice velocity.  Equations \eqref{surfkine} and \eqref{basekine} describe the movement of the ice surfaces caused by the velocity of the ice and the mass balance functions.

An important mathematical fact follows from the assumption of well-defined surface elevations and incompressibility.  Namely, that any \emph{pair} of these three equations implies the third:
  \begin{itemize}
  \item the surface kinematical equation \eqref{surfkine},
  \item the base kinematical equation \eqref{basekine}, and
  \item the map-plane mass continuity equation \eqref{masscont}.
  \end{itemize}
One proves the any-two-implies-the-other implications by using equation \eqref{incompressible} and the Leibniz rule for differentiating integrals (see the Exercises).  Thus the surface kinematical and mass continuity equations are closely-related.

\subsection*{Prognostic models}  Consider an explicit, geometry-evolving, isothermal ice sheet model, called a \emph{prognostic} model in glaciology.  Each time step follows this recipe:
  \begin{itemize}
  \item numerically solve an incompressible stress balance, yielding velocity $\mathbf{u}=(u,v,w)$,
    \begin{itemize}
    \item[$\circ$] the ice geometry and the stress boundary conditions determine $\mathbf{u}$
    \item[$\circ$] if the stress balance yields $\mathbf{U}=(u,v)$ then $w$ comes from equation \eqref{incompressible}
    \end{itemize}
  \item decide on a time step $\Delta t$ for \eqref{masscont} based on velocities and/or diffusivities,
  \item from the horizontal velocity $\mathbf{U}=(u,v)$, compute the flux $\bq = \int_b^h \bU dz = \bar{\bU} H$
  \item update mass balance $M=a-s$ and do a time-step of \eqref{masscont} to get $H_t$
  \item update the upper surface elevation and thickness, and repeat.
  \end{itemize}
The last step uses the rules $H \mapsto H + H_t \Delta t$ and $h \mapsto h + H_t \Delta t$, but it also enforces $H\ge 0$ and $h\ge b$ as mentioned above.  Most ice sheet models use the mass continuity equation \eqref{masscont} to describe changes in ice sheet geometry, but \eqref{surfkine} may be used instead.

The above ``standard explicit ice sheet model'' has many variations.  Some glaciological questions are answered just by solving the stress balance for the velocity, so the geometry does not evolve.  Sometimes the goal is the steady-state configuration of the glacier, both geometry and velocity, in which case the constraint $H\ge 0$ should be regarded as a part of the continuum formulation and the solver \cite{Bueler2016,JouvetBueler2012}.

Other processes are often simulated at each time step, such as the conservation of energy within the ice, or subglacial and supraglacial processes.  Understanding the diverse time scales associated to these processes is always an important step in designing a model which extends our ``introductory'' isothermal SIA model.

It may seem that when using SIA equation \eqref{sia} one bypasses the computation of the ice velocity.  That is because the mass continuity equation can be written as a diffusion, with $\bq=-D\nabla h$ for the flux.  Fast flow in ice sheets is associated with sliding and floating ice, however, and for these flows the ice geometry evolution is not a diffusion.  A complete ice flow model will be neither diffusive nor wave-like (hyperbolic), but the general formula $\bq = \bar{\bU} H$ will apply everywhere.  The ice velocity is always related in some way to the local surface gradient, but usually one must solve membrane-stress-balancing equations.  Solving the stress balance for the velocity field is both a generally-nontrivial and obligatory step in a numerical ice flow model.  The next section explores one important case.


\section{Shelves and streams}  \label{sec:shelvesandstreams}

As its name suggests, the \emph{shallow shelf approximation} (SSA) stress balance applies to floating \emph{ice shelves}.  It also applies reasonably well to grounded \emph{ice streams} which have not-too-steep bed topography and low basal resistance (Figure \ref{fig:siple}).  But what is, and is not, an ice stream?  Ice streams slide at $50$ to $1000 \,\text{m}\,\text{a}^{-1}$, they have a concentration of vertical shear in a thin layer near base, and typically they flow into ice shelves.  Pressurized liquid water at their beds plays a critical role enabling their fast flow.  However, there are other fast-flowing grounded parts of ice sheets,  generally called \emph{outlet glaciers}.  They can have even faster surface speed (up to $10 \,\text{km}\,\text{a}^{-1}$), but an unknown fraction of this speed is from sliding at the base.  In an outlet glacier there is substantial vertical shear within the ice column, sometimes caused by a thick layer of soft temperate ice above the bed.  Outlet glaciers are typically controlled by fjord-like, large-slope bedrock topography.  Few simplifying assumptions are appropriate for outlet glaciers, and the SSA is often not a sufficient model.

\twofigsizes{siple}{streamisbrae}{Left:  The SSA model applies to these Siple Coast ice streams \cite{Joughinetal2002}; color is radar-derived surface speed.  Right: Cross sections, with no vertical exaggeration, of (\textbf{a}) Jakobshavns Isbrae outlet glacier, Greenland and (\textbf{b}) Whillans Ice Stream, Siple Coast, Antarctica \cite{TrufferEchelmeyer}.}{2.8in}{2.9in}

\subsection*{The shallow shelf approximation (SSA)}  We state the SSA stress balance equation only in the plane flow, isothermal case:
\begin{equation}
  \left(2 B H |u_x|^{1/n - 1} u_x\right)_x - C|u|^{m-1}u = \rho g H h_x \label{ssaearly}
\end{equation}
The term in parentheses is the vertically-integrated longitudinal stress, also called the \emph{membrane stress} in two horizontal dimensions.  The second term $\tau_b = - C|u|^{m-1}u$ is the basal resistance, which is zero ($C=0$) in an ice shelf.  The term on the right is the negative of the driving stress ($\tau_d = - \rho g H h_x$).  Thus the longitudinal strain rates are determined by a balance involving the integrated ice hardness (coefficient $BH$), the slipperyness of the bed (coefficient $C$ and the power $m$) and the geometry of the ice (thickness $H$ and surface slope $h_x$).

In \eqref{ssaearly} the velocity $u$ is independent of $z$.  We assume that the ice hardness $B=A^{-1/n}$ is also independent of depth.  (Non-isothermal models compute the vertical average of the temperature-dependent hardness.)  The coefficient $\bar \nu = B |u_x|^{1/n-1}$ is the \emph{effective viscosity}, which depends on $u$; \eqref{ssaearly} can be written
\begin{equation}
  \left(2 \,\bar \nu\, H u_x\right)_x - C |u|^{m-1} u = \rho g H h_x.  \label{ssa}
\end{equation}

The inequality
\begin{equation}
\rho H < - \rho_w b     \label{flotation}
\end{equation}
is called the \emph{flotation criterion}.  In our simple mechanical model, a \emph{grounding line} occurs where $\rho H = - \rho_w b$.  For grounded ice ($\rho H \ge - \rho_w b$) the driving stress uses $h = H+b$.  For floating ice one uses $h = (1-\rho/\rho_w) H$ in the driving stress so that equation \eqref{ssa} simplifies to
\begin{equation}
   \left(2 \,\bar\nu\, H u_x\right)_x = \rho g (1-\rho/\rho_w) H H_x. \label{ssafloat}
\end{equation}

\subsection*{Steady ice shelf exact solution}  For a steady 1D ice shelf, in which $H_t=0$, van der Veen \cite{vanderVeen83} built an exact solution by noting that both sides in equation \eqref{ssafloat} are derivatives, thus the equation is integrable.  In fact, because the mass continuity equation \eqref{masscont} also reduces to $M=(uH)_x$ in the steady case, velocity and thickness simultaneously solving \eqref{masscont} and \eqref{ssafloat} can be found when $M$ is constant ($M=M_0$).  This exact solution is parameterized by $M_0$ and the ice thickness $H_g$ and velocity $u_g$ at the grounding line (i.e.~the inflow).

Supposing $H_g=500$ m, $u_g = 50 \,\text{m}\,\text{a}^{-1}$, and $M_0=30 \,\text{cm}\,\text{a}^{-1}$ we get the exact results shown in Figure \ref{fig:steadyshelfprofile}.  We will use this exact solution to verify a numerical SSA code.  Because driving stresses are highest near the grounding line, the highest longitudinal strain rates and thinning rates also occur there.

\twofig{steadyshelfprofile}{steadyshelfvelocity}{The upper and lower surface elevation (m; left) and velocity (m/a; right) of the exact ice shelf solution; $x=0$ is the grounding line.}

\subsection*{Numerical solution of the SSA}  Suppose the ice thickness is a known function $H(x)$.  To find the velocity we must solve the nonlinear PDE \eqref{ssa} or \eqref{ssafloat} for $u(x)$.  When we do this numerically an iteration is needed because of the nonlinearity with respect to $u$.  The simplest iterative approach is to use an initial guess at the velocity, then compute an effective viscosity, then get a new velocity solution from a linear PDE problem, and repeat until the change is as small as desired.  We will demonstrate such a \emph{fixed point} or \emph{Picard iteration}.  \emph{Newton iteration}, which would converge faster, is more complicated to implement and may require a better initial guess to converge at all.

Denote the previous velocity iterate as $u^{(k-1)}$ and the current iterate as $u^{(k)}$.  Compute $\bar \nu^{(k-1)} = B |u^{(k-1)}_x|^{1/n-1}$ and define $W^{(k-1)} = 2 \bar \nu^{(k-1)} H$.  Solving the following linear elliptic PDE for the unknown $u^{(k)}$ is a Picard iteration for \eqref{ssa}:
\begin{equation}
   \left(W^{(k-1)} u^{(k)}_x\right)_x - C |u^{(k-1)}|^{m-1} u^{(k)} = \rho g H h_x. \label{picardssa}
\end{equation}
If the difference between $u^{(k-1)}$ and $u^{(k)}$ were zero then we would have a solution of \eqref{ssa}.  In practice we stop the iteration when the difference is smaller than some tolerance.

Equation \eqref{picardssa} is a linear boundary value problem, written abstractly as
\begin{equation}
  \left(W(x)\, u_x\right)_x - \alpha(x)\, u = \beta(x)  \label{innerlinear}
\end{equation}
where the functions $W(x)$, $\alpha(x)$, $\beta(x)$ are known.  Equation \eqref{innerlinear} applies for $x$ in an interval $[x_g,x_c]$ where $x_g,x_c$ are the locations of the grounding line and calving front, respectively.  At $x_g$ we have $u(x_g)=u_g$.  In the ice shelf case we also have the calving front condition
\begin{equation}
  2 B H |u_x|^{1/n - 1} u_x = \frac{1}{2}\rho (1-\rho/\rho_w) g H^2  \label{calvingstress}
\end{equation}
at $x=x_c$; see Notes and References.  Notice that \eqref{calvingstress} can be solved for $u_x(x_c)=\gamma$ in terms of the thickness $H(x_c)$ at the calving front.

Where do we get an initial guess $u^{(0)}$?  Generally this may require effort, but the choice is straightforward in the 1D case.  For grounded ice, we may assume ice is held by basal resistance only: $u^{(0)}(x) = \left(-C^{-1} \rho g H h_x\right)^{1/m}$.  For floating ice, an initial velocity iterate comes from assuming a uniform strain rate provided by the boundary conditions: $u^{(0)}(x) = u_g + \gamma (x-x_g)$.

Suppose equation \eqref{innerlinear} applies on $[x_g,x_c]=[0,L]$ and choose a grid with equal spacing $\Delta x$.  For $j=1,2,\dots,J+1$ we let $x_j=(j-1)\Delta x$ so that $x_1 = 0$ and $x_{J+1} = L$ are the boundary points.  The coefficient $W(x)$ is needed on a staggered grid, for stability and accuracy reasons similar to those for the SIA diffusivity: $W_{j+1/2}$ at $x_{j+1/2} = x_j + \Delta x/2$.  Our finite difference approximation of \eqref{innerlinear} is, therefore,
\begin{equation}
  \frac{W_{j+1/2} (u_{j+1} - u_j) - W_{j-1/2} (u_{j} - u_{j-1})}{\Delta x^2} - \alpha_j u_j = \beta_j  \label{discreteinnerlinear}
\end{equation}

For the left end boundary condition we have $u_1 = u_g$ given, which is easy to include in the linear system (below).  For the right end boundary condition we have $u_x(L)=\gamma$, which requires more thought.  First introduce a notional point $x_{J+2}$, then require $(u_{J+2} - u_J)/(2 \Delta x) = \gamma$, which is a centered approximation to ``$u_x(x_c)=\gamma$,'' and then, using equation \eqref{discreteinnerlinear} in the $j=J+1$ case, eliminate the $u_{J+2}$ variable.  This procedure generates the last equation in our linear system.

Thus each iteration solves a linear system of $J+1$ equations of the form $A \mathbf{u} = \mathbf{b}$ or
\begin{equation}
\begin{bmatrix}
1 &  &  &  &  \\
W_{3/2} & a_{22} & W_{5/2} &  &  \\
 & W_{5/2} & a_{33} &  &  \\
 &  & \ddots & \ddots &  \\
 &  & W_{J-1/2} & a_{JJ} & W_{J+1/2} \\
 &  &  & a_{J+1,J} & a_{J+1,J+1} \\
\end{bmatrix}\,
\begin{bmatrix}
u_1 \\ u_2 \\ u_3 \\ \vdots \\ u_J \\ u_{J+1}
\end{bmatrix}
=
\begin{bmatrix}
u_g \\ \beta_2 \Delta x^2 \\ \beta_3 \Delta x^2 \\ \vdots \\ \beta_J \Delta x^2 \\ b_{J+1}
\end{bmatrix}  \label{discretematrixform}
\end{equation}
The diagonal entries $a_{jj}$ are
  $$a_{22} = -(W_{3/2}+W_{5/2}+\alpha_2 \Delta x^2), \quad \dots, \quad a_{JJ} = -(W_{J-1/2}+W_{J+1/2}+\alpha_J \Delta x^2).$$
There are special cases for the coefficients in the last equation:
  $$a_{J+1,J} = 2 W_{J+1/2}, \quad a_{J+1,J+1} = -(2 W_{J+1/2}+\alpha_{J+1}\Delta x^2).$$
For the right side of the last equation, $b_{J+1} = -2 \gamma \Delta x W_{J+3/2} + \beta_{J+1} \Delta x^2$.

System \eqref{discretematrixform} is a \emph{tridiagonal} linear system.  It is fully-appropriate to hand this linear system to Matlab's linear solver, the ``backslash'' operator ($\mathbf{u} = A\, \backslash\, \mathbf{b}$), especially at this initial implementation stage. Matlab will identify it as a tridiagonal system and solve it efficiently.  (These notes will not worry further about solving linear systems arising from discretization, but see \cite{Bueler2021}.)  Collecting these ideas yields the following function for the abstracted problem \eqref{innerlinear}:

\minput{flowline}

By \emph{manufacturing} exact solutions to \eqref{innerlinear}---see Notes and References---we can test this first piece before proceeding to solve the actual nonlinear SSA problem.   Results from \texttt{testflowline.m} (not shown) show that our implemented numerical scheme converges at the correct rate $O(\Delta x^2)$.

\subsection*{The case of an ice shelf}  The code \texttt{ssaflowline.m} below numerically computes the velocity for an ice shelf.  It calls \texttt{ssainit.m} (not shown) to get an initial iterate $u^{(0)}(x)$, and then \texttt{flowline.m} at each iteration, thereby implementing Picard iteration \eqref{picardssa} to solve \eqref{ssafloat}.  The thickness $H(x)$ is assumed given, so we are not yet addressing the full, \emph{coupled} ice shelf problem in which one simultaneously solves the mass continuity \eqref{masscont1D} and stress balance \eqref{ssafloat} equations for $H$ and $u$.

\minput{ssaflowline}

Does \texttt{ssaflowline.m} work correctly?  The exact thickness and velocity solution shown in Figure \ref{fig:steadyshelfprofile}, as evaluated by \texttt{exactshelf.m} (not shown), allows us to evaluate the numerical error.  The convergence result in Figure \ref{fig:shelfconv} is from codes \texttt{testshelf.m} and \texttt{shelfconv.m} (not shown), which call \texttt{ssaflowline.m}.  Even on a coarse $4$ km grid the maximum velocity error is less than 1 m/a, while the maximum velocity itself is $\sim 300$ m/a.  In particular, at screen resolution our numerical velocity solutions are the same as shown in Figure \ref{fig:steadyshelfprofile}.

\onefig{shelfconv}{The numerical SSA velocity solution from \texttt{ssaflowline.m} converges to the exact solution, at nearly the optimal rate $O(\Delta x^2)$, as the grid is refined from spacing $\Delta x=8000$ m to $\Delta x=100$ m.}

\subsection*{Realistic ice shelf modelling}  Real ice shelves have two horizontal variables, are confined in bays, and experience \emph{confining stresses} or side drag, which is to say membrane stresses in 2D.  Their velocities vary spatially and temporally along their grounding lines, which are now complicated curves.  Furthermore real ice shelves have nontrivial mass and energy processes on their surfaces, including high basal melt near grounding lines, marine ice basal freeze-on, and fracturing which nears full thickness at the calving front.  So the modeling of real ice shelves is complicated.

Nonetheless \emph{diagnostic} (fixed geometry) ice shelf modelling in two horizontal variables, where the velocity is unknown but the thickness is known and fixed, is quite successful using only the isothermal SSA model.  For example, Figure \ref{fig:rossquiver} shows a Parallel Ice Sheet Model (PISM) \cite{BBssasliding,Winkelmannetal2011} result for the Ross ice shelf, compared to observed velocities.  There is only one tuned parameter, the constant value of the ice hardness $B$.  Note that observed velocities for grounded ice were applied as boundary conditions.  Many current ice shelf models yield comparable match \cite{MacAyealetal}.

\twofigsizes{rossquiver}{rossscatter}{Left: Observed (white) and PISM-modeled (black) ice velocities are nearly the same across the whole Ross ice shelf.  Right: A scatter plot shows the same points by observed-vs-modeled ice speed.}{2.85in}{3.0in}


\section{Summary} \label{sec:summary}

These brief notes give an incomplete view of numerical ice flow models for glaciers and ice sheets.  As a meager conclusion here are four high-level views of such models:
\begin{itemize}
\item The mass continuity equation, a conservation equation in the map-plane, describes ice thickness changes.  In most ice sheet models it is the component which describes how the geometry evolves.  The numerical approach to this equation depends on the form of the stress balance which supplies the ice velocity, but, since it is a conservation equation, it is common to evaluate the ice flux on the staggered grid (finite difference thinking) or on cell boundaries (finite volume thinking).
\item The mass continuity equation has diffusive character (SIA-like) at larger spatial scales and in areas with significant basal resistance, but it is \emph{not} very diffusive for membrane-stress dominated areas.  Ice streams and shelves are often modeled by the membrane-stress-resolving SSA.
\item The SIA stress balance is exceptional because it contains no horizontal derivatives of the velocities.  It follows that in the SIA the velocity can be found simply by vertical integration of geometric quantities (e.g.~the driving stress).  No other stress balance is like this.
\item Membrane-stress-resolving balance equations, such as the SSA, Blatter-Pattyn, hydrostatic, and Stokes models, all determine horizontal velocity from solving spatial, elliptic-like PDEs using the ice geometry and stress boundary conditions.  Because of the Glen law these PDEs are nonlinear, so iteration is necessary.  At each iteration a sparse matrix ``inner'' problem is typically solved using a linear-algebra solver package, e.g.~a high-performance library like PETSc \cite{Bueler2021}.
\end{itemize}

We have illustrated some best practices for numerical modelling:
\begin{itemize}
\item Return often to the continuum model.
\item Modularize your codes.
\item Test your modules:  Does it show convergence to exact solutions?  Is it robust?
\end{itemize}


\section{Notes} \label{sec:nr}

Continuum modelling of ice flows is covered in textbooks \cite{CuffeyPaterson,GreveBlatter2009,vanderVeen}, and in the excellent review \cite{SchoofHewitt2013}, among other sources.

The SIA model, which was originally derived by several authors \cite{FowlerLarson1978,Hutter,MorlandJohnson}, follows from scaling the Stokes equations using the aspect ratio $\eps = [H]/[L]$, where $[H]$ is a typical thickness of an ice sheet and $[L]$ is a typical horizontal dimension.  After scaling one drops small terms in the $\eps\to 0$ limit \cite{Fowler,Hutter}, a ``small-parameter argument''.  In Fowler's form of the scaling argument \cite{Fowler} there are no $O(\eps)$ terms in the scaled equations so one only drops $O(\eps^2)$ terms.  The SIA is re-formulated in \cite{JouvetBueler2012} as a well-posed free boundary problem, by adding the constraint that the thickness is positive, thereby providing the correct boundary condition at grounded margins; a similar approach is in \cite{Bueler2016}.  The Mahaffy \cite{Mahaffy} scheme for diffusivity used here is not the only one \cite{HindmarshPayne}.  The Mahaffy scheme is the basis for an unconditionally-stable implicit scheme \cite{Bueler2016}.

The SSA model \cite{WeisGreveHutter} was first applied to ice shelves in \cite{Morland} and ice streams in \cite{MacAyeal}.  In deriving the SSA, the aspect ratio $\eps$ is one of two small parameters; the other describes the magnitude of surface undulations \cite{SchoofStream,SchoofHindmarsh}.  A well-posed model for the emergence of ice streams though till failure, using only the SSA, is in \cite{SchoofStream}.  Little theory is known about the well-posedness of the SSA+(mass continuity) coupled equations.

A major modelling issue omitted from these notes is thermomechanical coupling \cite{Blatteretal2010}.  Temperature is important because the ice softness varies by three orders of magnitude in the temperature range relevant to ice sheet modelling, and because temperature gives ice sheets a long memory of past climate.  While the geothermal flux is a significant input in slow-flowing parts of ice sheets, the dissipation of gravitational potential energy is often the dominant heat source, especially as it melts basal ice and facilitates sliding.  For example, each year the ice in the Jakobshavn drainage basin in Greenland dissipates enough gravitational potential energy to fully melt more than $1\,\text{km}^3$ of ice \cite{AschwandenBuelerKhroulevBlatter}.  In practice this is reflected as high basal water production.  Furthermore it heats large volumes of ice up to the pressure-melting temperature, thereby generating thick layers of temperate ice in outlet glaciers.  (Beautiful observation evidence appears in \cite{Luethietal2009}.)  These physical effects motivate modellers to solve the conservation of energy equation simultaneously with the mass conservation (mass continuity) and momentum conservation (stress balance) equations.  The conservation of energy equation is strongly advection-dominated for ice flows.  While some models only use temperature as the state variable \cite{BBL}, perhaps suitable for their coldest parts, ice sheets are generally polythermal \cite{FowlerLarson1978,Greve}.  Enthalpy methods track the energy content of polythermal ice sheets and glaciers \cite{AschwandenBuelerKhroulevBlatter,GreveBlatter2016}, though one may also solve a separate water-content equation in temperate ice \cite{Greve}.

Pressurized basal water is usually required for ice to slide at significant speed.  To model the production of such water one must at least compute the basal melt rate via the energy conservation equation \cite{BBssasliding,BuelervanPelt2015,Clarke05,Raymondenergy,Tulaczyketal2000b}.  Beyond this statement there is little consensus on what is essential, or even constructive, in terms of process sub-models to improve the modeling of ice sheet sliding.  Belief in one's preferred cartoon of subglacial morphology will lead to continuum equations for subglacial hydrology, and then numerical experiments will proceed.

One of the most significant issues in modelling ice sheets using shallow models is to describe the ``switch'', in space and time, between shear-dominated and membrane-stress-dominated flow.  It is not a good idea to abruptly switch from the SIA model to the SSA model at the edge of an ice stream, though this was attempted in early models \cite{HulbeMacAyeal,Ritzetal2001}.  Instead \emph{hybrid} schemes exist which solve the SIA and SSA everywhere in the ice sheet \cite{BBssasliding,PollardDeConto,Winkelmannetal2011} and then combine the stresses or velocities according to different schemes.  Coherent vertically-integrated models have also arisen \cite{BrinkerhoffJohnson2013,Goldberg2011}.

Solving the Stokes stress balance normally accomodates the incompressibility constraint by using pressure as an unknown \cite{Bueler2021,JouvetRappaz2011,Lengetal2012,ISMIPHOM}.  (Separate Appendix A shows a 2D example.)  Numerical approximations of this stress balance are indefinite, thus harder to solve.  In plane flow one may address the incompressibility constraint by using stream functions \cite{BaliseRaymond1985}.

``Higher-order'' three-dimensional approximations of the Stokes stress balance, such as the Blatter-Pattyn model \eqref{stressblatter} \cite{Blatter,Pattyn03,SchoofHindmarsh}, are also shallow approximations in fact.  Even Stokes ice sheet models typically apply the most-basic shallow assumption of well-defined thickness (see main text).  Higher-order models add an assumption such as hydrostatic normal stress \cite{GreveBlatter2009}.  Computational limitations generally restrict either the spatial extent, the spatial resolution, or the run duration of these models relative to SIA-SSA hybrids, but careful numerical analysis may generate more computationally-efficient solutions \cite{Brown2013}.  Vertically-integrated and hybrid models will always allow finer map-plane resolution and longer time scales than higher-order and Stokes models, simply because 2D stress balance equations are easier to solve.  On the other hand, questions remain about what are the most important deficiencies, relative to the Stokes model, when using either higher-order \cite{ISMIPHOM} or hybrid models.

The finite difference material in these notes should probably be read with a reference like \cite{LeVequeFD} or \cite{MortonMayers} in hand.  The ``main theorem for numerical PDE schemes'' mentioned in the text is the Lax equivalence theorem.  Alternative numerical discretization techniques include the finite element \cite{Braess}, finite volume \cite{LeVeque}, and spectral \cite{Trefethen} methods.  Newton iteration for the nonlinear discrete equations is superior to Picard iteration used here, in terms of rapid convergence once iterates are near the solution, but care is needed to globalize convergence \cite{Kelley}.  High-performance Newton solvers for nonlinear PDEs are demonstrated in \cite{Bueler2021}.

Which are the best numerical models for moving grounding lines?  Even when the minimal SSA stress balance is used, this is still something of an open question \cite{Feldmannetal2014,Goldbergetal2009,MISMIP3d2013,MISMIP2012,SchoofMarine1}.  The physics requires at least that the quantities $H$ and $u$ are continuous there.  Multiple stress balance regimes exist in the vicinity of the grounding line \cite{SchoofMarine2}.

Where to find exact solutions for ice flow models?  Textbooks by van der Veen \cite{vanderVeen} and Greve and Blatter \cite{GreveBlatter2009} have a few.  Halfar's similarity solution to the SIA \cite{Halfar81,Halfar83} has been generalized to non-zero mass balance \cite{BLKCB}.  There are flow-line \cite{Bodvardsson,vanderVeen83} and cross-flow \cite{SchoofStream} solutions to the SSA model, and one can even construct an exact, steady marine ice sheet in the flow-line case \cite{Bueler2014exactmarine}.  For the Stokes equations themselves there are plane flow solutions for constant viscosity \cite{BaliseRaymond1985}.

More generally, for numerical verification purposes one can \emph{manufacture} exact solutions by starting with a specified solution and then deriving a source term so that the specified function is actually a solution \cite{Bueler2021,Roache}.  The literature contains such manufactured solutions to the thermomechanically-coupled SIA \cite{BBL}, plane flow Blatter-Pattyn model \cite{GlowinskiRappaz}, and Glen-law Stokes equations \cite{JouvetRappaz2011,Lengetal2012,SargentFastook2010}.

\footnotesize

\bigskip
\bigskip
%\bibliographystyle{siam}
\input{notes.bbl}

\begin{comment}
\bigskip
\bigskip
\small
\section*{Exercises}

\newcommand{\exer}[2]{\medskip\noindent \textbf{#1.}\quad #2}

\exer{1}{Assume $f$ has continuous derivatives of all orders.  Show using Taylor's theorem:
  $$f'(x) = \frac{f(x+\Delta) - f(x-\Delta)}{2\Delta} + O(\Delta^2) \quad \text{and} \quad f''(x) = \frac{f(x+\Delta) - 2 f(x) + f(x-\Delta)}{\Delta^2} + O(\Delta^2).$$}

\exer{2}{Sometimes we want finite difference approximations for derivatives in-between grid points.  Continuing exercise \textbf{1}, show $f'(x+(\Delta/2)) = (f(x+\Delta) - f(x))/\Delta + O(\Delta^2)$.}

\exer{3}{To help understand colon notation, rewrite \texttt{heat.m} using \texttt{for} loops instead.}

\exer{4}{The 1D explicit scheme \eqref{heat1Dfd} for the heat equation, namely $T_j^{n+1} = \mu T_{j+1}^n + (1 - 2 \mu) T_j^n + \mu T_{j-1}^n$, is averaging if stability criterion \eqref{stabcrit} holds.  But of course we must be stepping \emph{forward} in time.  Show that the scheme is not averaging for any values of $\Delta t < 0$.  Try running \texttt{heat.m} backward in time to see what happens.  Moral: \emph{there are no consistent and stable numerical schemes for unstable PDE problems}.}

\exer{5}{Show that when written as a formula for $T_j^{n+1}$, implicit scheme \eqref{implicit1D} has only positive coefficients.  Explain why this shows it is unconditionally stable.  Refer to \cite{LeVequeFD,MortonMayers}.}

\exer{6}{\emph{This multi-part exercise concerns the staggered-grid treatment of $\Div\left(D\,\grad\dots\right)$}.
\renewcommand{\labelenumi}{(\alph{enumi})}
\begin{enumerate}
\item Write down the obvious centered $O(\Delta t)+O(\Delta x^2)$ explicit finite difference method for the equation $u_t = D_0 u_{xx} + E_0 u_x$, assuming $D_0>0$ and $E_0$ are constant.  Solve the scheme for the unknown $u_j^{n+1}$. 
\item Stability for the method in (a) occurs if $u_j^{n+1}$ is computed from a linear combination of time $t_n$ values which has all nonnegative coefficients.  If $|E_0| \gg D_0$, what does this stability assertion say about $\Delta x$?
\item Show that if $D=D(x,y)$ and $u=u(x,y)$ then $\Div \left(D\, \grad u\right) = D \grad^2 u + \grad D \cdot \grad u$.
\item Why do we use the staggered grid for ``$\Div\left(D\,\grad\right)$,'' instead of expanding by the product rule as in part (c)?  References \cite{LeVequeFD,MortonMayers} may help you formulate your answer.
\end{enumerate}
}

\exer{7}{Derive the Green's function of the 1D heat equation, namely $T = (4 \pi D t)^{-1/2}\, e^{-x^2/(4Dt)}$, which is a solution to $T_t=D T_{xx}$, as follows:  Suppose there is a solution of the form $T(t,x) = t^{-1/2} \phi(s)$, where $s=t^{-1/2}x$ is the similarity variable, and then apply the chain rule.  Generate an ordinary differential equation for $\phi(s)$, in the single variable $s$, and solve it.}

\exer{8}{In the text, and in the code \texttt{verifysia.m}, we used Halfar's solution to verify our numerical scheme \texttt{siaflat.m}.  Create the analogous code \texttt{verifyheat.m} to use the Green's function (previous exercise) of the 2D heat equation \eqref{heat2D}, to verify \texttt{heatadapt.m}.  You can use the high quality approximation $e^{-A^2}\approx 0$ for $|A|>10$ to choose a rectangular domain in space for which you may use $T=0$ Dirichlet boundary conditions.  (This hack is unnecessary for the SIA!)}

\exer{9}{Show that the Halfar solution formula \eqref{halfar} solves the SIA equation \eqref{sia} in the case of flat bed ($h=H$), zero climatic mass balance ($M=0$), and $n=3$.  You will want to express divergence and gradient in polar coordinates.}

\exer{10}{Show, by integrating formula \eqref{halfar}, and changing variables, that the volume of ice in the Halfar solution is independent of $t$.}

\exer{11}{In the text it is claimed that any modification of \texttt{siaflat.m} will make the output of \texttt{verifysia.m} show non-convergence.  For example, the reported average thickness error will not go to zero at the correct rate, as the grid is refined, if there are coding errors.  By randomly altering lines of \texttt{siaflat.m}, or by other methods of your choice, evaluate this claim.}

\exer{12}{Some output from \texttt{verifysia.m} has been suppressed in the text, including a map-plane view of the numerical ice thickness error.  Run the program to see this error map.  Near the ice sheet margin this error is much larger than elsewhere.  Why?  On the same grids, would a higher-order or Stokes model for an ice sheet with an advancing margin have significantly smaller thickness error, supposing we knew a relevant exact solution?}

\exer{13}{Derive the surface kinematical equation \eqref{surfkine} from the mass continuity \eqref{masscont} and base kinematical \eqref{basekine} equations.  You will use the incompressibility of ice, equation \eqref{incompressible}.  Note that the Leibniz rule for differentiating integrals, mentioned in the text, is
  $$\frac{d}{dx}\left(\int_{g(x)}^{f(x)} h(x,y)\,dy\right) = f'(x) h(x,f(x)) - g'(x) h(x,g(x)) + \int_{g(x)}^{f(x)} h_x(x,y)\,dy.$$}

\exer{14}{Let $C_s = A (\rho g (1-r)/4)^n$ where $r=\rho/\rho_w$.  Assume $x_g=0$ is the location of the grounding line.  Derive the two parts of the van der Veen exact ice shelf solution, namely
\begin{align*}
  u &= \left[ u_g^{n+1} + (C_s/M_0) \left((M_0 x + u_g H_g)^{n+1} - (u_g H_g)^{n+1}\right) \right]^{1/(n+1)}, \quad H = (M_0 x + u_g H_g) / u,
\end{align*}
Start from equation \eqref{ssafloat}, and use the fact $(H^2)_x = 2 H H_x$ to generate the first integral of \eqref{ssafloat}.  Also use boundary condition \eqref{calvingstress}.  Get an equation $u_x = C_s H^n$ or equivalent.  On the other hand, note that the mass continuity equation $M_0=(uH)_x$ can be integrated to give the formula $uH = M_0 (x-x_g) + u_g H_g$ for the flux.  Use this expression for $uH$ to find $u(x)$ first, and then write $H(x)$ in terms of $u(x)$ as above.  These exact solutions are from \cite{vanderVeen83}.  They are used in code \texttt{exactshelf.m}.}

\exer{15}{Modify the code \texttt{ssaflowline.m} to solve the ice stream SSA equation \eqref{ssa}.  For boundary conditions it would be reasonable to have fixed velocity at the upstream end, but keep the calving front boundary condition at the downstream end; the calving front is at the point where the ice stream reaches flotation.  Compare exact solutions in \cite{Bodvardsson,Bueler2014exactmarine}.}

\exer{16}{Derive the hydrostatic \eqref{stresshydrostatic} equation, in detail.}

\exer{17}{Build a better glacier or ice sheet model.}
\end{comment}
\end{document}
